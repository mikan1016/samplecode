<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>うまく試着できるかな？</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    margin: 0;
    background: #f4f4f4;
  }

  #gameContainer {
    width: 100%;
    max-width: 430px;
    margin: 0 auto;
    position: relative;
  }

  #background {
    width: 100%;
    height: auto;
    border: 2px solid #555;
  }

  #movingImg {
    position: absolute;
    width: 300px;
    height: 660px;
    pointer-events: none;
  }

  #controls {
    margin-top: 15px;
  }
</style>
</head>
<body>

<h2>うまく試着できるかな？（ゲームモード）</h2>

<div>
  背景画像を選ぶ：<br>
  <input type="file" id="bgInput" accept="image/*">
</div>

<div>
  動く画像を選ぶ：<br>
  <select id="characterSelect">
    <option value="uniform1.png">画像1（制服A）</option>
    <option value="uniform2.png">画像2（制服B）</option>
  </select>
</div>

<div id="gameContainer">
  <img id="background" src="" alt="背景画像">
  <img id="movingImg" src="uniform1.png">
</div>

<div id="controls">
  <button id="startBtn">動かす</button>
  <button id="stopBtn">止める</button>
  <p>最高得点：<span id="bestScore">0</span></p>
</div>

<script>
let moveInterval;
let bestScore = 0;

const bgInput = document.getElementById("bgInput");
const background = document.getElementById("background");
const movingImg = document.getElementById("movingImg");
const characterSelect = document.getElementById("characterSelect");

// 背景画像読み込み
bgInput.addEventListener("change", function(e){
  const file = e.target.files[0];
  if(file){
    background.src = URL.createObjectURL(file);
  }
});

// 動く画像選択
characterSelect.addEventListener("change", () => {
  movingImg.src = characterSelect.value;
});

// ランダム移動（中心に行く確率 1/4）
function moveImage() {
  const bgRect = background.getBoundingClientRect();
  const w = movingImg.offsetWidth;
  const h = movingImg.offsetHeight;

  let x, y;

  if (Math.random() < 0.25) {
    // 中央寄せ強化
    x = bgRect.left + bgRect.width / 2 + (Math.random() * 40 - 20);
    y = bgRect.top + bgRect.height / 2 + (Math.random() * 40 - 20);
  } else {
    x = bgRect.left + Math.random() * (bgRect.width - w);
    y = bgRect.top + Math.random() * (bgRect.height - h);
  }

  movingImg.style.left = x + "px";
  movingImg.style.top = y + "px";
}

// 動かす
document.getElementById("startBtn").onclick = () => {
  clearInterval(moveInterval);
  moveInterval = setInterval(moveImage, 200);
};

// 止める
document.getElementById("stopBtn").onclick = () => {
  clearInterval(moveInterval);

  const bgRect = background.getBoundingClientRect();
  const imgRect = movingImg.getBoundingClientRect();

  const centerX_bg = bgRect.left + bgRect.width / 2;
  const centerY_bg = bgRect.top + bgRect.height / 2;

  const centerX_img = imgRect.left + imgRect.width / 2;
  const centerY_img = imgRect.top + imgRect.height / 2;

  const dx = centerX_bg - centerX_img;
  const dy = centerY_bg - centerY_img;
  const distance = Math.sqrt(dx * dx + dy * dy);

  const score = Math.max(0, Math.floor(1000 - distance));

  if (score > bestScore) {
    bestScore = score;
    document.getElementById("bestScore").textContent = bestScore;
  }
};
</script>

</body>
</html>
