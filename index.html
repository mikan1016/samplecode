<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>うまく試着できるかな？</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: sans-serif;
    text-align: center;
    margin: 0;
    background: #f0f0f0;
    padding: 10px;
  }

  h2 {
    margin-top: 10px;
  }

  #gameContainer {
    width: 100%;
    max-width: 430px;
    margin: 10px auto;
    position: relative;
  }

  #background {
    width: 100%;
    height: auto;
    border-radius: 10px;
    border: 2px solid #666;
  }

  #movingImg {
    position: absolute;
    width: 300px;
    height: 660px;
    pointer-events: none;
  }

  button {
    padding: 12px 20px;
    font-size: 17px;
    border-radius: 10px;
    border: none;
    margin: 5px;
    background: #4caf50;
    color: white;
  }

  button:active {
    opacity: 0.7;
  }

  .share-btn {
    background: #1d9bf0;
    border-radius: 8px;
  }

  .line-btn {
    background: #00b900;
  }

  a.page-link {
    display: block;
    margin-top: 20px;
    padding: 12px;
    background: #555;
    color: white;
    text-decoration: none;
    border-radius: 10px;
  }
</style>
</head>
<body>

<h2>うまく試着できるかな？（ゲームモード）</h2>

<div>
  <p>背景画像を選ぶ：</p>
  <input type="file" id="bgInput" accept="image/*">
</div>

<div>
  <p>動く画像を選ぶ：</p>
  <select id="characterSelect">
    <option value="uniform1.png">画像1（制服A）</option>
    <option value="uniform2.png">画像2（制服B）</option>
  </select>
</div>

<div id="gameContainer">
  <img id="background" src="">
  <img id="movingImg" src="uniform1.png">
</div>

<button id="startBtn">動かす</button>
<button id="stopBtn">止める</button>

<p>最高得点：<span id="bestScore">0</span></p>

<hr>

<h3>SNS共有</h3>
<button class="share-btn" onclick="shareTwitter()">X（Twitter）で共有</button><br>
<button class="line-btn" onclick="shareLine()">LINEで共有</button>

<hr>

<a class="page-link" href="free-move.html">→ 自由移動モードへ</a>

<script>
let moveInterval;
let bestScore = 0;

const bgInput = document.getElementById("bgInput");
const background = document.getElementById("background");
const movingImg = document.getElementById("movingImg");
const characterSelect = document.getElementById("characterSelect");

// 背景画像読込
bgInput.addEventListener("change", function(e){
  const file = e.target.files[0];
  if(file){
    background.src = URL.createObjectURL(file);
  }
});

// キャラ変更
characterSelect.addEventListener("change", () => {
  movingImg.src = characterSelect.value;
});

// ランダム移動（1/4 で中央へ寄る）
function moveImage() {
  const bgRect = background.getBoundingClientRect();
  const w = movingImg.offsetWidth;
  const h = movingImg.offsetHeight;

  let x, y;

  if (Math.random() < 0.25) {
    // 中央に寄せる
    x = bgRect.left + bgRect.width / 2 - w/2 + (Math.random()*40 - 20);
    y = bgRect.top + bgRect.height / 2 - h/2 + (Math.random()*40 - 20);
  } else {
    x = bgRect.left + Math.random()*(bgRect.width - w);
    y = bgRect.top + Math.random()*(bgRect.height - h);
  }

  movingImg.style.left = x + "px";
  movingImg.style.top = y + "px";
}

// 動かす
document.getElementById("startBtn").onclick = () => {
  clearInterval(moveInterval);
  moveInterval = setInterval(moveImage, 200);
};

// 止める
document.getElementById("stopBtn").onclick = () => {
  clearInterval(moveInterval);

  const bgRect = background.getBoundingClientRect();
  const imgRect = movingImg.getBoundingClientRect();

  const cx_bg = bgRect.left + bgRect.width/2;
  const cy_bg = bgRect.top + bgRect.height/2;

  const cx_img = imgRect.left + imgRect.width/2;
  const cy_img = imgRect.top + imgRect.height/2;

  const dx = cx_bg - cx_img;
  const dy = cy_bg - cy_img;

  const distance = Math.sqrt(dx*dx + dy*dy);
  const score = Math.max(0, Math.floor(1000 - distance));

  if(score > bestScore){
    bestScore = score;
    document.getElementById("bestScore").textContent = bestScore;
  }
};

// ===== SNS共有 =====
function shareTwitter(){
  const text = encodeURIComponent("試着ゲームで遊んでみた！最高得点は " + bestScore + " 点！");
  const url = encodeURIComponent(location.href);
  window.open("https://twitter.com/intent/tweet?text="+text+"&url="+url);
}

function shareLine(){
  const text = encodeURIComponent("試着ゲームで遊んでみた！最高得点は " + bestScore + " 点！");
  const url = encodeURIComponent(location.href);
  window.open("https://line.me/R/msg/text/?" + text + "%0D%0A" + url);
}
</script>

</body>
</html>
